"use strict";function DefaultTextLayerFactory(){}var TextLayerBuilder=function(){function b(a){this.textLayerDiv=a.textLayerDiv,this.renderingDone=!1,this.divContentDone=!1,this.pageIdx=a.pageIndex,this.pageNumber=this.pageIdx+1,this.matches=[],this.viewport=a.viewport,this.textDivs=[],this.findController=a.findController||null,this.textLayerRenderTask=null,this._bindMouse()}return b.prototype={_finishRendering:function(){this.renderingDone=!0;var b=document.createElement("div");b.className="endOfContent",this.textLayerDiv.appendChild(b);var c=document.createEvent("CustomEvent");c.initCustomEvent("textlayerrendered",!0,!0,{pageNumber:this.pageNumber}),this.textLayerDiv.dispatchEvent(c)},render:function(b){if(this.divContentDone&&!this.renderingDone){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),this.textDivs=[];var c=document.createDocumentFragment();this.textLayerRenderTask=PDFJS.renderTextLayer({textContent:this.textContent,container:c,viewport:this.viewport,textDivs:this.textDivs,timeout:b}),this.textLayerRenderTask.promise.then(function(){this.textLayerDiv.appendChild(c),this._finishRendering(),this.updateMatches()}.bind(this),function(a){})}},setTextContent:function(b){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),this.textContent=b,this.divContentDone=!0},convertMatches:function(b){for(var c=0,d=0,e=this.textContent.items,f=e.length-1,g=null===this.findController?0:this.findController.state.query.length,h=[],i=0,j=b.length;i<j;i++){for(var k=b[i];c!==f&&k>=d+e[c].str.length;)d+=e[c].str.length,c++;c===e.length&&console.error("Could not find a matching mapping");var l={begin:{divIdx:c,offset:k-d}};for(k+=g;c!==f&&k>d+e[c].str.length;)d+=e[c].str.length,c++;l.end={divIdx:c,offset:k-d},h.push(l)}return h},renderMatches:function(b){function k(a,b){var c=a.divIdx;d[c].textContent="",l(c,0,a.offset,b)}function l(a,b,e,f){var g=d[a],h=c[a].str.substring(b,e),i=document.createTextNode(h);if(f){var j=document.createElement("span");return j.className=f,j.appendChild(i),void g.appendChild(j)}g.appendChild(i)}if(0!==b.length){var c=this.textContent.items,d=this.textDivs,e=null,f=this.pageIdx,g=null!==this.findController&&f===this.findController.selected.pageIdx,h=null===this.findController?-1:this.findController.selected.matchIdx,i=null!==this.findController&&this.findController.state.highlightAll,j={divIdx:-1,offset:void 0},m=h,n=m+1;if(i)m=0,n=b.length;else if(!g)return;for(var o=m;o<n;o++){var p=b[o],q=p.begin,r=p.end,s=g&&o===h,t=s?" selected":"";if(this.findController&&this.findController.updateMatchPosition(f,o,d,q.divIdx,r.divIdx),e&&q.divIdx===e.divIdx?l(e.divIdx,e.offset,q.offset):(null!==e&&l(e.divIdx,e.offset,j.offset),k(q)),q.divIdx===r.divIdx)l(q.divIdx,q.offset,r.offset,"highlight"+t);else{l(q.divIdx,q.offset,j.offset,"highlight begin"+t);for(var u=q.divIdx+1,v=r.divIdx;u<v;u++)d[u].className="highlight middle"+t;k(r,"highlight end"+t)}e=r}e&&l(e.divIdx,e.offset,j.offset)}},updateMatches:function(){if(this.renderingDone){for(var b=this.matches,c=this.textDivs,d=this.textContent.items,e=-1,f=0,g=b.length;f<g;f++){for(var h=b[f],i=Math.max(e,h.begin.divIdx),j=i,k=h.end.divIdx;j<=k;j++){var l=c[j];l.textContent=d[j].str,l.className=""}e=h.end.divIdx+1}null!==this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}},_bindMouse:function(){var b=this.textLayerDiv;b.addEventListener("mousedown",function(a){var c=b.querySelector(".endOfContent");if(c){var d=a.target!==b;if(d=d&&"none"!==window.getComputedStyle(c).getPropertyValue("-moz-user-select")){var e=b.getBoundingClientRect(),f=Math.max(0,(a.pageY-e.top)/e.height);c.style.top=(100*f).toFixed(2)+"%"}c.classList.add("active")}}),b.addEventListener("mouseup",function(a){var c=b.querySelector(".endOfContent");c&&(c.style.top="",c.classList.remove("active"))})}},b}();DefaultTextLayerFactory.prototype={createTextLayerBuilder:function(a,b,c){return new TextLayerBuilder({textLayerDiv:a,pageIndex:b,viewport:c})}};
